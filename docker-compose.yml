version: '3'

services:
  ox_app:
    image:  registry.gitlab.com/lunar-logic/ox:v1.0.5
    container_name: ox_app
    volumes:
      - ./app-blank:/home/app/current/
      - ./ox:/home/app/current/ox
    depends_on:
      - ox_db
    ports:
      - "8080:80"
      - "8443:443"
    tty: true
    command: bash -c "mkdir -p /home/app/current/log && chmod 777 /home/app/current/log && service postfix start && /usr/local/bin/apache2-foreground"

  ox_db:
    image: registry.gitlab.com/lunar-logic/docker/dev-mongo:v1.0.0
    container_name: ox_db
    ports:
      - "8445:80"
    volumes:
      - ./dump/:/home/app/data/dump/
      - ./db:/data/db
    logging:
      driver: none